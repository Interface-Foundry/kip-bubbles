var request = require('request'),
    Promise = require('bluebird')
    async = require('async'),
    urlify = require('urlify').create({
        spaces: "",
        nonPrintable: "",
        trim: true
    });



module.exports = {
    parse: function(array) {
        var common = ['the', 'it', 'is', 'a', 'an', 'and', 'by', 'to', 'he', 'she', 'they', 'we', 'i', 'are', 'to', 'for', 'of', 'with']
        var finalTags = [];
        var tags = array.join(' ')
        tags = tags.replace(/'s/g, ''); //get rid of 's stuff (apostrophes and plurals, like "women's" or "men's". this removes the 's)
        tags = tags.replace(/[^\w\s]/gi, ''); //remove all special characters
        tags = tags.replace(/\s+/g, ' ').trim(); //remove extra spaces from removing chars
        tags = tags.removeStopWords(); //remove all stop words
        array = tags.split(' ')

        var uniqueArray = eliminateDuplicates(array);
        var commonString = common.join();
        for (var i = 0; i < uniqueArray.length; i++) {
            var tag = urlify(uniqueArray[i]).toLowerCase();
            if (commonString.indexOf(tag) == -1) {
                finalTags.push(tag);
            }
        }

        finalTags = categorize(finalTags);
        finalTags = eliminateDuplicates(finalTags);
        finalTags = finalTags.map(function(tag) {
            return tag.charAt(0).toUpperCase() + tag.slice(1).toLowerCase();
        })

        return finalTags;
    },

    filter: function(array) {
        var finalTags = [];
        var x;
        var y;
        var word;
        var stop_word;
        var regex_str;
        var regex;
        var cleansed_string = array.join(' ')
        var common = ['the', 'it', 'is', 'a', 'an', 'and', 'by', 'to', 'he', 'she', 'they', 'we', 'i', 'are', 'to', 'for', 'of', 'with']
        cleansed_string = cleansed_string.replace(/'s/g, ''); //get rid of 's stuff (apostrophes and plurals, like "women's" or "men's". this removes the 's)
        cleansed_string = cleansed_string.replace(/[^\w\s]/gi, ''); //remove all special characters
        cleansed_string = cleansed_string.replace(/\s+/g, ' ').trim(); //remove extra spaces from removing chars
        cleansed_string = cleansed_string.removeStopWords(); //remove all stop words
        array = cleansed_string.split(' ')
        var uniqueArray = eliminateDuplicates(array);
        var commonString = common.join();
        for (var i = 0; i < uniqueArray.length; i++) {
            var tag = urlify(uniqueArray[i]).toLowerCase();
            if (commonString.indexOf(tag) == -1) {
                finalTags.push(tag);
            }
        }

        var stop_words = new Array(
            "accessories",
            "audio",
            "batteries",
            "chargers",
            "cameras",
            "photo",
            "car",
            "electronics",
            "cell",
            "phone",
            "buyer",
            "packaging",
            "warranty",
            "company",
            "high",
            "quality",
            "prices",
            "tenet",
            "products",
            "shop",
            "favorites",
            "list",
            "excellence",
            "feedback",
            "concerns",
            "message",
            "hours",
            "holidays",
            'list',
            'reported',
            "home",
            'games',
            "garden",
            'yours',
            'gadgets',
            'outdoor',
            'player',
            'toys',
            'hobbies',
            'card',
            'memory',
            "computer",
            'nice',
            'bookmark',
            'regards',
            'choices',
            'flash',
            'disk',
            'prices',
            'replace',
            'refund',
            'understanding',
            'immediately',
            'neutral',
            'tenet',
            'negative',
            'satisfactory',
            'satisfaction',
            'plz',
            'quality',
            "menu",
            "hd",
            "greetings",
            'unless',
            "mistakes",
            "happen",
            "keeping",
            "differences",
            "accurately",
            "recently",
            "checking",
            "auctions",
            "private",
            "permission",
            "develop",
            "privacy",
            "secide",
            "expected",
            'disclaimer',
            "remove",
            "exception",
            "automatic",
            "assistant",
            'bank',
            "relist",
            "leave",
            "contacting",
            'defective',
            "accepts",
            "start",
            "map",
            "assure",
            "leaving",
            "currency",
            "getting",
            "determines",
            "mention",
            "mentioning",
            'false',
            'urge',
            "remote",
            "overseas",
            "oversea",
            "ground",
            "speed",
            "options",
            "date",
            'remember',
            "require",
            "direct",
            "indirect",
            "signatures",
            "aware",
            "signature",
            "requirement",
            "daytime",
            "reach",
            "policies",
            "return",
            "instruction",
            "message",
            "invoice",
            "describing",
            "returnexchangerefund",
            "original",
            "receives",
            "defective",
            "equal",
            "lesser",
            "correct",
            "shortshipments",
            'impossible',
            'issues',
            'reply',
            'goal',
            'track',
            "bidders",
            "process",
            "timely",
            "careful",
            "recent",
            "send",
            "rightaway",
            "satisfy",
            "am",
            "outside",
            "takeaway",
            "convenience",
            "united",
            "post",
            "helps",
            "attempts",
            "arrives",
            "involves",
            "awaiting",
            "effort",
            "yourself",
            "hope",
            "understand",
            "questions",
            "feel",
            "firstly",
            "try",
            "solve",
            "assured",
            "preferred",
            "sent",
            'win',
            "mail",
            "ups",
            "luck",
            "discounts",
            "portion",
            "reflect",
            "final",
            "demand",
            "unavailable",
            "notified",
            "required",
            "protect",
            "quicker",
            "transaction",
            "verified",
            "void",
            "voided",
            "incorrect",
            "entered",
            "checkout",
            "promptly",
            "changes",
            "change",
            "afternoon",
            "receiving",
            "approved",
            "expedited",
            "quality",
            "reasonable",
            "expect",
            "friendly",
            "wish",
            "question",
            "manner",
            "continental",
            "using",
            "numbers",
            "emailed",
            "mail",
            "broker",
            "processing",
            "posted",
            "purchases",
            "page",
            "read",
            "country",
            "office",
            "determine",
            "buying",
            "assume",
            "lost",
            "stolen",
            "priority",
            "envelope",
            "average",
            "weeks",
            "estimated",
            "past",
            "estimates",
            "throughout",
            "attached",
            "charged",
            "restocking",
            "authorization",
            'soon',
            "dedicated",
            "providing",
            "continue",
            "strive",
            "choice",
            "lightning",
            "fast",
            "superior",
            "thousands",
            'stock',
            'difference',
            'able',
            "disputes",
            "resolve",
            "emails",
            "volume",
            "daily",
            "left",
            "positive",
            "score",
            "incoming",
            'try',
            "foremost",
            'various',
            "instead",
            "opening",
            'total',
            'amount',
            'standards',
            'agree',
            'expired',
            'similar',
            'brand',
            'picture',
            'replace',
            'repair',
            'tell',
            'reported',
            'period',
            'excluding',
            'exclude',
            'months',
            'manufacturer',
            'nonpayment',
            'based',
            'number',
            'id',
            'misused',
            'apply',
            'soon',
            'receive',
            'securely',
            'smoke',
            'pet',
            'makes',
            'powered',
            'pro',
            'search',
            'support',
            'icon',
            'savings',
            'offering',
            'wide',
            'assortment',
            'edited',
            'exact',
            'professional',
            'profile',
            'sort',
            'action',
            'browse',
            'ease',
            'fingertips',
            'offers',
            'oz',
            'width',
            'length',
            'tested',
            'defected',
            "giving",
            "withdrawal",
            "expire",
            "multiple",
            "exercise",
            "inform",
            "writing",
            'queries',
            'rest',
            'authority',
            'logistic',
            'center',
            "lot",
            "arrangement",
            "unwanted",
            "traceable",
            "documented",
            "brief",
            'removed',
            'signs',
            "matched",
            "depends",
            "insurance",
            "doing",
            "honest",
            "cheating",
            "fair",
            "trading",
            "trust",
            "viewing",
            "enjoy",
            "chance",
            "promised",
            "internet",
            "adjust",
            'earlier',
            'yes',
            'benefits',
            'checked',
            'pal',
            "highly",
            "depends",
            'ideas',
            "instructions",
            "facebook",
            "twitter",
            "instagram",
            'like',
            'social',
            "safety",
            "gear",
            'media',
            "friendly",
            "little",
            "dear",
            "cautious",
            "instructions",
            "tools",
            "easy",
            "job",
            "technical",
            "skills",
            'display',
            "disassembling",
            "assembling",
            "decision",
            'statistic',
            "response",
            "cause",
            "changing",
            "parts",
            "non-printable",
            "approximately",
            "inquiries",
            "respond",
            "tips",
            "varied",
            "analytics",
            "uncontrollable",
            "forces",
            'arrived',
            "viewing",
            "answered",
            "resent",
            'pays',
            'restock',
            "cant",
            "match",
            "mentioned",
            "satisfactorily",
            "square",
            "metres",
            "fulltime",
            "employees",
            "endeavor",
            "manufacture",
            "repeatedly",
            "calculated",
            "fault",
            "sell",
            'sooner',
            'heard',
            'separately',
            "cover",
            "refunded",
            "descriptions",
            'individually',
            "doa",
            "majority",
            "turbo",
            "link",
            "hide",
            "sending",
            "taping",
            "major",
            "cards",
            "lister",
            "tool",
            "manage",
            "risk",
            'refer',
            "national",
            "career",
            'advertised',
            'quick',
            'ability',
            "echecks",
            "clears",
            'enhance',
            'scrolling',
            'noticed',
            'templates',
            "nonnegotiable",
            "beyond",
            'doubt',
            "accepting",
            'resolved',
            "postmark",
            "allotted",
            "minus",
            "suggest",
            "internationally",
            "control",
            "leaves",
            "dead",
            "arrival",
            "nondefective",
            "concern",
            "happy",
            "answer",
            "write",
            "goods",
            "notify",
            "directly",
            "happens",
            "occasionally",
            "covered",
            "pleased",
            "guide",
            'guildline',
            "matches",
            "wish",
            "mailed",
            "quoted",
            "program",
            "serious",
            "posting",
            "retract",
            "ends",
            "pride",
            "whatsoever",
            "bad",
            "review",
            "doesnt",
            "weight",
            "countries",
            "won",
            "closing",
            "notice",
            "mean",
            "credits",
            "worldwide",
            "delayed",
            'spam',
            'box',
            "special",
            "declaration",
            "sold",
            'computers',
            'recommendation',
            "live",
            "saturday",
            "saturdays",
            "delivering",
            "feeling",
            "late",
            "freight",
            "pick",
            "confuse",
            "anytime",
            "committed",
            "commitment",
            "superb",
            "successful",
            "selling",
            "individual",
            "customer",
            "amazing",
            "compared",
            "retailers",
            "identical",
            "abilities",
            "accurate",
            "utmost",
            "conscientiousness",
            "avoid",
            "potential",
            "oversights",
            "respectfully",
            "helping",
            "mutually",
            "thoroughly",
            "reviewing",
            "representation",
            "subject",
            "manufacturing",
            "variance",
            "distort",
            "requirements",
            "massage",
            "closed",
            "public",
            "good",
            "communication",
            "cenefits",
            'star',
            'stars',
            'errors',
            "incurred",
            "failure",
            "example",
            "laser",
            "pointer",
            "unacceptable",
            "related",
            "destination",
            "missing",
            "duty",
            "obligation",
            "liability",
            "citizen",
            "confidence",
            "dispatched",
            "transfer",
            "timeframe",
            "unexpected",
            "delays",
            "weather",
            "week",
            "confirmation",
            "shipments",
            "sell",
            "merchandise",
            "sellers",
            "appreciate",
            "appreciated",
            "patience",
            "havent",
            "concerned",
            "instantly",
            'report',
            "undue",
            "delay",
            "calendar",
            "cancellation",
            "arrange",
            "collected",
            "effects",
            "withdraw",
            "reimburse",
            "outbound",
            "supplementary",
            "type",
            "event",
            "informed",
            "contract",
            "carry",
            "reimbursement",
            "means",
            "initial",
            "expressly",
            "agreed",
            "otherwise",
            "incur",
            'selection',
            'images',
            'times',
            'vary',
            'components',
            'selections',
            'compelling',
            'experience',
            'pulling',
            'complete',
            'aims',
            'audience',
            'opportunity',
            'youll',
            'upcoming',
            'noon',
            'rate',
            'rates',
            'usps',
            'class',
            'applied',
            'ca',
            'open',
            'aim',
            'regarding',
            'placed',
            'browsed',
            'shopping',
            'fell',
            'below',
            'toll',
            'postal',
            'timing',
            'software',
            'automated',
            'inventory',
            'template',
            'design',
            'hear',
            'flat',
            'table',
            'approximate',
            'business',
            'day',
            'cleared',
            'weekends',
            'buyers',
            'note',
            'usa',
            'stores',
            'listing',
            'purchased',
            'person',
            'sizes',
            'kindly',
            'please',
            'pls',
            'charges',
            'satisfied',
            'buyer',
            'processed',
            'seller',
            'payment',
            'shipping',
            'shipped',
            'returns',
            'returned',
            'refunds',
            'refund',
            'cancel',
            'scan',
            'save',
            'code',
            'sign',
            'subscriber',
            'deals',
            'deal',
            'free',
            'month',
            'china',
            'operating',
            'installation',
            'warranty',
            'extend',
            'extended',
            'physically',
            'damaged',
            'nofrmal',
            'prepaid',
            'placing',
            'costtime',
            'recommended',
            'urgently',
            'sat',
            'sun',
            'asap',
            'airmail',
            'faster',
            'dhl',
            'local',
            'undeliverable',
            'feedback',
            'store',
            'pictures',
            'website',
            'factor',
            'content',
            'contents',
            'categories',
            'accept',
            'acceptable',
            'via',
            'paypal',
            'please',
            'requests',
            'request',
            'package',
            'packages',
            'etc',
            'processed',
            'replacement',
            'exceptions',
            'received',
            'verification',
            'confirmed',
            'addresses',
            'address',
            'transit',
            'provided',
            'carrier',
            'excludes',
            'transit',
            'urgent',
            'tracking',
            'packaging',
            'ebay',
            'supplier',
            'located',
            'location',
            'supply',
            'supplier',
            'email',
            'newsletters',
            'newsletter',
            'adding',
            'services',
            'copy',
            'duplicate',
            "positive",
            "feedbacks",
            "left",
            "completed",
            "parties",
            "complaints",
            "solution",
            "members",
            'value',
            'transactions',
            'chart',
            'monitors',
            'copyright',
            'rights',
            'information',
            'questions',
            'considered',
            'issue',
            'verification',
            'products',
            'product',
            'solutions',
            'signup',
            'accepted',
            'guarantee',
            'links',
            'promotions',
            'money',
            'helpful',
            'items',
            'included',
            'shown',
            'actual',
            'item',
            'particularly',
            'shipment',
            'customer',
            'status',
            'available',
            'warehouse',
            'delivery',
            'countries',
            'auction',
            'result',
            'item',
            'unpaid',
            'account',
            'automatically',
            'close',
            'accumulate',
            'measurement',
            'except',
            'determined',
            'include',
            'customs',
            'importation',
            'reliable',
            'credit',
            'standing',
            'including',
            'welcome',
            'thanks',
            'your',
            'add',
            'policy',
            'policies',
            'maintain',
            'bidding',
            'bid',
            'receipt',
            'provide',
            'specific',
            'reason',
            'return',
            'section',
            'handling',
            'returnsnotaccepted',
            'service',
            'customer',
            'customers',
            'added',
            'days',
            'returnsrefunds',
            'according',
            'correspond',
            'themselves',
            'measured',
            'hand',
            'deviations',
            'ignore',
            'sometimes',
            'larger',
            'chinese',
            'description',
            'visit',
            'you',
            'buy',
            'ship',
            'video',
            'surveillance',
            'detailed',
            'parcel',
            'combined',
            'discount',
            'sales',
            'method',
            'wholes',
            'credited',
            "error",
            "packed",
            "dispatch",
            "team",
            "facility",
            "delivered",
            "measure",
            "hopefully",
            "idea",
            "stain",
            "rips",
            "preview",
            "update",
            "displayed",
            "showing",
            "slightly",
            "calibrated",
            "replaced",
            'notes',
            'wholesale',
            "taking",
            "validconfirmed",
            "billing",
            "matchpayment",
            'official',
            'licensed',
            "resort",
            "two",
            "depended",
            "courier",
            "hello",
            "friends",
            "feature",
            "stuff",
            "afford",
            "competitive",
            "designers",
            "manufacturers",
            "safe",
            "secure",
            "online",
            "photos",
            "wear",
            "effect",
            "bodies",
            "model",
            "strongly",
            "recommend",
            "main",
            "goes",
            "great",
            "correctly",
            "described",
            "pictured",
            "priced",
            "air",
            "mail",
            "even",
            "pass",
            "dispute",
            "paypal",
            "prepare",
            "packet",
            "assistance",
            "understandingwe",
            "orderif",
            'taking',
            'factors',
            "expense",
            "issued",
            "normally",
            "wellpacked",
            "bubbled",
            "ready",
            "stated",
            "upgraded",
            "express",
            'condition',
            "wrappers",
            "eligible",
            "resend",
            "exchanged",
            "reshipping",
            "nonrefundable",
            "deducted",
            "guidelines",
            "health",
            "regulations",
            "telephone",
            "deliveryexcluding",
            "contrived",
            "damagement",
            "moneyback",
            "guaranteed",
            "messages",
            "promise",
            "solution",
            "global",
            "pnline",
            "retail",
            'comes',
            'contact',
            'content',
            'help',
            'trouble',
            'combined',
            'offer',
            'confirm',
            'registered',
            'trademark',
            'inspected',
            'clearance',
            'msrp',
            'neglect',
            'accident',
            'alterations',
            'misuse',
            'loss',
            'abuse',
            'caused',
            'defects',
            'accidents',
            'defect',
            'resulting',
            'improper',
            'scratches',
            'workmanship',
            'additional',
            'costs',
            'cost',
            'taxes',
            'tax',
            'responsibility',
            'import',
            'duties',
            'charge',
            'terms',
            'specifications',
            'price',
            'varies',
            'depending',
            'purchase',
            'measurements',
            'approximate',
            'hours',
            'posession',
            'holiday',
            'days',
            'weekends',
            'holidays',
            'arrive',
            'international',
            'company',
            'conditions',
            'cannot',
            'wait',
            'patiently',
            'declared',
            'choose',
            'system',
            'custom',
            'concerns',
            'a',
            'about',
            'above',
            'across',
            'after',
            'again',
            'against',
            'all',
            'almost',
            'alone',
            'along',
            'already',
            'also',
            'although',
            'always',
            'among',
            'an',
            'and',
            'another',
            'any',
            'anybody',
            'anyone',
            'anything',
            'anywhere',
            'are',
            'area',
            'areas',
            'around',
            'as',
            'ask',
            'asked',
            'asking',
            'asks',
            'at',
            'away',
            'b',
            'be',
            'became',
            'because',
            'become',
            'becomes',
            'been',
            'before',
            'began',
            'behind',
            'being',
            'beings',
            'best',
            'better',
            'between',
            'both',
            'but',
            'by',
            'c',
            'came',
            'can',
            'cannot',
            'case',
            'cases',
            'certain',
            'certainly',
            'clearly',
            'come',
            'could',
            'd',
            'did',
            'differ',
            'different',
            'differently',
            'do',
            'does',
            'done',
            'downing',
            'downs',
            'during',
            'e',
            'each',
            'early',
            'either',
            'end',
            'ended',
            'ending',
            'enough',
            'evenly',
            'ever',
            'every',
            'everybody',
            'everyone',
            'everything',
            'everywhere',
            'f',
            'fact',
            'facts',
            'far',
            'find',
            'finds',
            'first',
            'for',
            'four',
            'from',
            'fully',
            "inches",
            "dimensions",
            "made",
            "materials",
            "thumbnail",
            "tab",
            "select",
            "obtain",
            "associated",
            "selected",
            "occasional",
            "occur",
            "completing",
            "typically",
            "heavier",
            "indicated",
            "shipper",
            "depend",
            "settle",
            "bidder",
            "enter",
            "legally",
            "sole",
            "discretion",
            "totalshipping",
            "sum",
            "opinion",
            'youre',
            "refundable",
            "willing",
            "inquiry",
            "fastest",
            "stand",
            "matter",
            "advertisement",
            "complexity",
            "logistics",
            "intended",
            "utilize",
            "fund",
            "eventually",
            "policy",
            "acceptedy",
            "itemrefund",
            "nackreturn",
            "name",
            "referred",
            "demonstrate",
            "interacts",
            "specified",
            "engineered",
            "unbrandedgeneric",
            "clothes",
            'further',
            'furthered',
            'furthering',
            'furthers',
            'g',
            'gave',
            'general',
            'generally',
            'get',
            'gets',
            'give',
            'given',
            'gives',
            'go',
            'going',
            'got',
            'h',
            'had',
            'has',
            'have',
            'having',
            'he',
            'her',
            'here',
            'him',
            'his',
            'how',
            'however',
            'i',
            'if',
            'important',
            'in',
            'interest',
            'interested',
            'interesting',
            'interests',
            'into',
            'is',
            'it',
            'its',
            'itself',
            'j',
            'just',
            'k',
            'keep',
            'keeps',
            'kind',
            'knew',
            'know',
            'known',
            'knows',
            'l',
            'largely',
            'last',
            'later',
            'latest',
            'least',
            'less',
            'let',
            'lets',
            'like',
            'likely',
            'longer',
            'longest',
            'm',
            'made',
            'make',
            'making',
            'many',
            'might',
            'more',
            'most',
            'mostly',
            'much',
            'must',
            'my',
            'myself',
            'n',
            'necessary',
            'need',
            'needed',
            'needing',
            'needs',
            'never',
            'new',
            'new',
            'newer',
            'newest',
            'next',
            'no',
            'nobody',
            'non',
            'noone',
            'not',
            'nothing',
            'now',
            'nowhere',
            'o',
            'of',
            'often',
            'on',
            'once',
            'one',
            'only',
            'opens',
            'or',
            'order',
            'ordered',
            'ordering',
            "lighting",
            "screen",
            "resolution",
            "pad",
            "measures",
            "browser",
            "disabled",
            "upgrade",
            "double",
            "traffic",
            'gallery',
            'tissue',
            'orders',
            'other',
            'others',
            'our',
            'out',
            'over',
            'p',
            'per',
            'perhaps',
            'place',
            'places',
            'pointing',
            'points',
            'possible',
            'present',
            'presented',
            'presenting',
            'presents',
            'problem',
            'problems',
            'put',
            'puts',
            'q',
            'quite',
            'r',
            'rather',
            'really',
            'right',
            'right',
            'room',
            'rooms',
            's',
            'said',
            'same',
            'saw',
            'say',
            'says',
            'second',
            'seconds',
            'see',
            'seem',
            'seemed',
            'seeming',
            'seems',
            'sees',
            'several',
            'shall',
            'should',
            'show',
            'showed',
            'shows',
            'side',
            'sides',
            'since',
            'so',
            'some',
            'somebody',
            'someone',
            'something',
            'somewhere',
            'state',
            'states',
            'still',
            'still',
            'such',
            'sure',
            't',
            'take',
            'taken',
            'than',
            'that',
            'the',
            'their',
            'them',
            'then',
            'there',
            'therefore',
            'these',
            'they',
            'thing',
            'things',
            'think',
            'thinks',
            'this',
            'those',
            'though',
            'thought',
            'thoughts',
            'through',
            'thus',
            'to',
            'together',
            'too',
            'took',
            'toward',
            'turn',
            'turned',
            'turning',
            'turns',
            'u',
            'under',
            'undefined',
            'until',
            'up',
            'upon',
            'us',
            'use',
            'used',
            'uses',
            'v',
            'very',
            'w',
            'want',
            'wanted',
            'wanting',
            'wants',
            'was',
            'way',
            'ways',
            'we',
            'well',
            'wells',
            'went',
            'were',
            'what',
            'when',
            'where',
            'whether',
            'which',
            'while',
            'who',
            'whole',
            'whose',
            'why',
            'will',
            'with',
            'within',
            'without',
            'work',
            'worked',
            'working',
            'works',
            'would',
            'x',
            'y',
            'year',
            'years',
            'yet',
            'z',
            'click',
            'view',
            'full',
            'size',
            'image',
            'includes',
            'coordinating',
            'use',
            'products',
            'monday',
            'tuesday',
            'wednesday',
            'thursday',
            'friday',
            'shipped.',
            'absolutely',
            "family",
            "run",
            "relisted",
            "sale",
            "cancelled",
            "gladly",
            "extension",
            "worldwide",
            'economy',
            "significantly",
            "represented",
            'sorry',
            'pics',
            "specially",
            "pre",
            "owned",
            "charging",
            "weekdays",
            "significantly",
            'sundays',
            "represented",
            'preowned',
            "committing",
            "reflecting",
            "discounted",
            "incorrectly",
            'methods',
            'offered',
            'smartpost',
            'fedex',
            'rating',
            "airline",
            "inspection",
            "border",
            "waiting",
            "cooperation",
            'dollar',
            'hour',
            'individuals',
            'responsibilities',
            'javascript',
            'enable',
            'disable',
            'unknown',
            "excellent",
            "cheapest",
            'friend',
            "domestic",
            "immediate",
            'assist',
            'instructed',
            'marketing',
            'application',
            'standard',
            'overnight',
            'world',
            'directions',
            'packing',
            'attn',
            'attn:',
            'paid',
            'third-party',
            'merchandise.',
            'responsible',
            'payments',
            'caused',
            'inconvenience',
            'apologise',
            'apologize',
            'maintenance',
            'undergoing',
            'currently',
            'postage',
            'details',
            'length',
            'attention',
            'transportation',
            'youve',
            'dont',
            'worry',
            'situation',
            'disappear',
            'time',
            'samples',
            'reference',
            'due',
            'limitations',
            'photography',
            'inevitable',
            'dofferemces',
            'monitor',
            'settings',
            'photograph',
            'may',
            'website',
            'fee',
            'excluded',
            'dhl',
            'asap',
            'usually',
            'deviation',
            'undeliverable',
            'differs',
            'allows',
            'returning',
            'pay',
            'own',
            'exchange',
            'alaska',
            'hawaii',
            'puerto',
            'rico',
            'porto',
            'port',
            'features',
            'wrong',
            'regular',
            'reserve',
            'ems',
            'takes',
            'sunday',
            'check',
            'part',
            'fees',
            'replacements',
            'info',
            'subscribers',
            'back',
            'detail',
            'letter',
            'tag',
            'following',
            'allow',
            'manual',
            'data',
            "prior",
            "granted",
            "sizing",
            "thank",
            "looking",
            "adhering",
            "policyreturns",
            "sizingdoesnt",
            "listings",
            "ensure",
            "proper",
            'handle',
            'parcels',
            "compare",
            'sender',
            'greatest',
            'completely',
            "listed",
            "winning",
            "opened",
            "recieved",
            "combine",
            'decrease',
            'flights',
            "discover",
            "examined",
            "visa",
            "mastercard",
            "attempting",
            "verify",
            "validity",
            'source',
            'particular',
            'percentage',
            'reaching',
            'consider',
            'insure',
            "fraud",
            "examine",
            "refuse",
            "unable",
            "driver",
            "license",
            "passport",
            'airport',
            'ships',
            'conversion',
            'convert',
            'dollar',
            'paying',
            'payable',
            'government',
            'agency',
            'agencies',
            'occured',
            'internal',
            "suspect",
            "fraudulent",
            "highest",
            "plus",
            'tags',
            'applicable',
            "hesitate",
            "me",
            "purchasing",
            "inspect",
            "department",
            "road",
            'reasons',
            "carefully",
            "describe",
            "ratings",
            "lived",
            "board",
            "flaws",
            "refuse",
            "call",
            "found",
            "human",
            "mistake",
            "rightmeasurements",
            "unsure",
            "fitall",
            "nonsmoking",
            "mind",
            "guarantees",
            "declare",
            "form",
            'avenue',
            'category',
            'mon',
            'fri',
            'inc',
            'warehouses',
            "claim",
            "allowed",
            "exchanges",
            'florida',
            'set',
            'whichever',
            "implemented",
            "acknowledge",
            "release",
            "dates",
            "preorder",
            "compatible",
            "carriers",
            "officially",
            'websites',
            "choosing",
            "stop",
            "exiting",
            "wont",
            "updated",
            "insured",
            "claim",
            "passed",
            'january',
            'february',
            'march',
            'april',
            'may',
            'june',
            'july',
            'august',
            'september',
            'october',
            'november',
            'december',
            'flaw',
            "rightso",
            "fix",
            "mainly",
            "classification",
            "virtually",
            "commercial",
            'minor',
            "liable",
            "damages",
            "actually",
            "fix",
            'approx',
            "nonpayers",
            "collection",
            "shoot",
            'plan',
            "prevent",
            "million",
            "history",
            "presence",
            "allergens",
            "aspect",
            "pertaining",
            "damages",
            "press",
            "valued",
            "replay",
            "whenever",
            "respond",
            "designed",
            'checks',
            'few',
            'advance',
            "mass",
            "production",
            'approximation',
            "quickly",
            "claims",
            "eelse",
            "advantage",
            "nation",
            "intl",
            "taiwan",
            "hongkong",
            "macao",
            "bangladesh",
            "brunel",
            "myanmar",
            "cambodia",
            "east",
            "timor",
            "indonesia",
            "laos",
            "malaysia",
            "philipines",
            "singapore",
            "thailand",
            "vietnam",
            "mongolia",
            "canada",
            "belgium",
            "denmark",
            "kingdom",
            "greece",
            "luxembourg",
            "netherlands",
            "norway",
            "portugal",
            "spain",
            "switzerland",
            "sweden",
            "austria",
            "rumania",
            "poland",
            "hungary",
            "czech",
            "bahrain",
            "iran",
            "iraq",
            "israel",
            "jordan",
            "turkey",
            "kuwait",
            "saudi",
            "arabia",
            "qatar",
            "syria",
            "austraila",
            "zealand",
            "papua",
            "guinea",
            "guam",
            "saipan",
            "afganistan",
            "india",
            "nepal",
            "pakistan",
            "sri",
            "lanka",
            "russia",
            "mexico",
            "panama",
            "argentina",
            "brazil",
            "uruguay",
            "people",
            "couldnt",
            "shops",
            "decided",
            "popular",
            "peru",
            "cuba",
            "tahiti",
            "ten",
            "embarking",
            "journey",
            "onto",
            "vision",
            "bring",
            "leading",
            "resource",
            "growing",
            "properly",
            "favorite",
            "statues",
            "feliveries",
            "dominica",
            "fiji",
            "kiribati",
            "solomon",
            "islands",
            "meant",
            "guideline",
            "appropriate",
            "samoa",
            "kenya",
            "libya",
            "andorra",
            "australia",
            "british",
            "virgin",
            "noted",
            "house",
            "point",
            "chosen",
            "systems",
            "operate",
            "real",
            "pm",
            "eastern",
            "placement",
            "call",
            "availability",
            "bulgaria",
            "cook",
            "croatia",
            "cyprus",
            "republic",
            "england",
            "estonia",
            "finland",
            "camera",
            "motors",
            "keyword",
            "titles",
            "cellphone",
            'titles',
            "gibraltar",
            "greenland",
            "hong",
            "kong",
            "iceland",
            "ireland",
            "latvia",
            'document',
            "misrepresented",
            "qualified",
            "authorized",
            "organizations",
            "built",
            "convenient",
            "ontime",
            "key",
            "importance",
            "ahead",
            "quantities",
            "fulfilled",
            "nonpaying",
            "arriving",
            "faulty",
            "evaluation",
            "maybe",
            "flight",
            "disaster",
            "impact",
            "patient",
            "favourite",
            "lithuania",
            "assembled",
            "counterfeit",
            "filed",
            "procedures",
            "marked",
            "shipto",
            "disappointed",
            "personal",
            "marketers",
            "malta",
            "consideration",
            "values",
            "gifts",
            "prohibit",
            "behavior",
            "knowing",
            "simply",
            "follow",
            "steps",
            "mailing",
            "down",
            "envelop",
            "contacted",
            "merchant",
            "restrictions",
            "postmarked",
            "monaco",
            "antilles",
            "northern",
            "philippines",
            "romania",
            "scotland",
            "slovakia",
            "slovenia",
            "south",
            "sfrica",
            "debacles",
            "forced",
            "implement",
            "actions",
            "dsr",
            "emailing",
            "successfully",
            'workdays',
            "korea",
            "ukraine",
            'law',
            'stopping',
            "operation",
            "greatly",
            "notification",
            "arrivals",
            "operated",
            "closely",
            "forfeit",
            "backup",
            "today",
            "ecommerce",
            "fine",
            "insurer",
            "depression",
            "consignment",
            "stockpiled",
            "servicing",
            "clients",
            "extending",
            "true",
            "forfeited",
            "requested",
            "nearly",
            'manager',
            "scheduling",
            "research",
            'laws',
            "subjected",
            "machine",
            'germany',
            "exceeding",
            "arab",
            "basically",
            "calculator",
            "discard",
            "print",
            "unauthorized",
            "duplication",
            "prohibited",
            'changed',
            "movement",
            "forms",
            "arrangements",
            "statement",
            "deny",
            'starting',
            "cm",
            "inch",
            "submitting",
            "preparing",
            "inside",
            "processor",
            "printed",
            "refused",
            'busy',
            "issuing",
            "unverified",
            "accounts",
            "suspicious",
            "unforeseen",
            "deliveries",
            "possibility",
            "prove",
            "easier",
            "emirates",
            "promotion",
            "necessarily",
            "waive",
            "specialists",
            "processor",
            "retaliatory",
            "remarks",
            "outlined",
            "encourage",
            'charts',
            'guides',
            "slight",
            "variations",
            "deformations",
            "imperfections",
            "imply",
            "color",
            "trusted",
            "notices",
            "minimum",
            "maximum",
            'african',
            'ive',
            'meet',
            'anyway',
            "arranging",
            "po",
            "declare",
            "gift",
            'catalog',
            "importing",
            "edits",
            "reorder",
            "form",
            "pickup",
            "tx",
            "overview",
            "damage",
            "meaning",
            "performance",
            "originally",
            "messaging",
            "claim",
            "allowed",
            "exchanges",
            "rma",
            "forhere",
            "hold",
            "cst",
            "junk",
            "trunk",
            "salem",
            "waco",
            "faq"
        )

        finalTags = finalTags.join(' ');
        // Split out all the individual words in the phrase
        words = finalTags.match(/[^\s]+|\s+[^\s+]$/g)

        // Review all the words

        if (!words || words == null || words == undefined) {
            return ''
        }

        for (x = 0; x < words.length; x++) {

            //Remove any word with digits in them "3W" "4E" etc
            var matches = words[x].match(/\d+/g);
            if (matches !== null) {
                finalTags = finalTags.replace(words[x], "");
            }

            // For each word, check all the stop words
            for (y = 0; y < stop_words.length; y++) {
                // Get the current word
                word = words[x].replace(/\s+|[^a-z]+/ig, ""); // Trim the word and remove non-alpha

                // Get the stop word
                stop_word = stop_words[y];

                // If the word matches the stop word, remove it from the keywords
                if (word.toLowerCase().trim() == stop_word) {
                    // Build the regex
                    regex_str = "^\\s*" + stop_word + "\\s*$"; // Only word
                    regex_str += "|^\\s*" + stop_word + "\\s+"; // First word
                    regex_str += "|\\s+" + stop_word + "\\s*$"; // Last word
                    regex_str += "|\\s+" + stop_word + "\\s+"; // Word somewhere in the middle
                    regex = new RegExp(regex_str, "ig");
                    // Remove the word from the keywords
                    finalTags = finalTags.replace(regex, " ");
                }
            }
        }
        var finalt = finalTags.replace(/^\s+|\s+$/g, "").split(' ');
        finalt = eliminateDuplicates(finalt);
        finalt = finalt.map(function(tag) {
                return tag.charAt(0).toUpperCase() + tag.slice(1).toLowerCase();
            })
            // console.log('finalTags: ',finalTags)
        return finalt
    },
    colorize: function(tags) {

        var hexCodes = [{
            'red': '#ea0000'
        }, {
            'orange': '#f7a71c'
        }, {
            'yellow': '#fcda1f'
        }, {
            'green': '#89c90d'
        }, {
            'aqua': '#7ce9ed'
        }, {
            'blue': '#00429c'
        }, {
            'purple': '#751ed7'
        }, {
            'pink': '#f75dc4'
        }, {
            'white': '#ffffff'
        }, {
            'grey': '#999999'
        }, {
            'black': '#000000'
        }, {
            'brown': '#663300'
        }]
        var colors = []
        var color = '';
        hexCodes.forEach(function(hash) {
            for (var key in hash) {
                if (hash.hasOwnProperty(key)) {

                    if (tags instanceof Array) {
                        tags.forEach(function(tag) {
                            if (key.toLowerCase().trim() == tag.toLowerCase().trim()) {
                                colors.push(hash[key]);
                            }
                        })
                    } else if (tags instanceof String) {
                        if (key.toLowerCase().trim() == tag.toLowerCase().trim()) {
                            color = hash[key];
                        }
                    }
                }
            }
        })
        var result
        if (colors && colors.length > 0) {
            result = colors
        } else if (color && color.length > 0) {
            result = color
        } else {
            result = null
        }
        return result
    }
}


function categorize(tags) {
    // outerwear, dresses, tops, skirts, pants, underwear, activewear (formerly swimwear), tights & leggings, shoes, bags, accessories, jewelry
    var newCategories = [];
    var categories = [{
        'Tops': [
            'top',
            'shirt',
            'sweater',
            'tshirt',
            't-shirt',
            'sleeveless',
            'long-sleeve',
            'longsleeve',
            'vest',
            'jersey',
            'dress-shirt',
            'dressshirt',
            'button-down',
            'buttondown',
            'polo',
            'polo-shirt',
            'tank',
            'tanktop',
            'tank-top',
            'blouse',
            'henley',
            'crop',
            'croptop',
            'crop-top',
            'tube',
            'tubetop',
            'tube-top',
            'jeantop',
            'jean-top',
            'halter',
            'haltertop',
            'turtle',
            'turtleneck',
            'turtle-neck'
        ]
    }, {
        'Dresses': [
            'dress',
            'sundress',
            'wedding',
            'maxi',
            'gown',
            'bubble',
            'tiered',
            'corset',
            'tea',
            'teadress',
            'wrap',
            'wrapdress',
            'blouson',
            'halter',
            'babydoll',
            'bodycon'
        ]
    }, {
        'Outerwear': [
            'jacket',
            'coat',
            'blazer',
            'hoodie',
            'suit',
            'windbreaker',
            'parka',
            'leather-jacket',
            'leatherjacket',
            'harrington',
            'harrington-jacket',
            'harringtonjacket',
            'poncho',
            'robe',
            'shawl',
            'tuxedo',
            'overcoat',
            'over-coat',
            'sport-coat',
            'sportcoat',
            'waistcoat',
            'waist-coat',
            'duffle',
            'dufflecoat',
            'duffle-coat',
            'peacoat',
            'pea',
            'britishwarm',
            'british-warm',
            'ulster',
            'ulster-coat',
            'winterjacket',
            'winter-jacket',
            'puffer',
            'puffer-jacket',
            'cagoule',
            'chesterfield',
            'cover-coat',
            'covercoat',
            'duffle-coat',
            'bomber',
            'bomber-jacket',
            'bomberjacket',
            'trench',
            'trenchcoat',
            'trench-coat',
            'rain',
            'raincoat',
            'guardjacket',
            'guard-jacket',
            'mess',
            'mess-jacket',
            'messjacket',
            'opera',
            'operacoat',
            'opera-coat',
            'shrug'
        ]
    }, {
        'Pants': [
            'shorts',
            'pants',
            'pant',
            'jeans',
            'jean',
            'trousers',
            'trouser',
            'chaps',
            'cargo',
            'capri',
            'palazzo',
            'palazzos',
            'chinos',
            'chino',
            'khaki',
            'khakis',
            'overalls',
            'yoga-pants',
            'yogapants',
            'lowrise',
            'lowrise-pants',
            'lowrisepants',
            'sweatpants',
            'sweat-pants',
            'parachute',
            'phat',
            'pedal-pushers',
            'pedalpushers',
            'dresspants',
            'dress-pants',
            'bellbottoms',
            'bell-bottoms',
            'cycling',
            'highwater',
            'high-water',
            'bermuda',
            'windpants',
            'wind-pants'
        ]
    }, {
        'Shoes': [
            'shoe',
            'shoes',
            'sneaker',
            'sneakers',
            'boot',
            'boots',
            'slipper',
            'slippers',
            'sandal',
            'sandals',
            'spat',
            'spats',
            'croc',
            'crocs',
            'dress-shoes',
            'boot',
            'boots',
            'flip-flops',
            'flip-flop',
            'sandal',
            'heels',
            'high-heels',
            'highheels'
        ]
    }, {
        'Skirts': [
            'skirt',
            'miniskirt',
            'mini-skirt',
            'a-line',
            'aline',
            'aline-skirt',
            'ballerina',
            'ballerina-skirt',
            'denimskirt',
            'denim-skirt',
            'jobskirt',
            'job-skirt',
            'job',
            'microskirt',
            'micro-skirt',
            'pencil-skirt',
            'pencilskirt',
            'praire',
            'praire-skirt',
            'praireskirt',
            'rah-rah',
            'rahrah',
            'tutu',
            'wrap-skirt',
            'wrapskirt',
            'leatherskirt',
            'leather-skirt'
        ]
    }, {
        'Bags': [
            'backpack',
            'handbag',
            'hand-bag',
            'handbags',
            'chanel',
            'duffel',
            'satchel',
            'tote',
            'messenger',
            'saddle',
            'clutch',
            'wristlet'
        ]
    }, {
        'Accessories': [
            'sunglasses',
            'watch',
            'wristwatch',
            'scarf',
            'sash',
            'headband',
            'glasses',
            'cufflink',
            'tie',
            'necktie',
            'bow',
            'bowtie',
            'belt',
            'bandana',
            'suspenders',
            'wallet'
        ]
    }, {
        'Activewear': [
            'swim',
            'swimwear',
            'swim-wear',
            'swimsuit',
            'swim-suit',
            'swim-briefs',
            'swimbriefs',
            'wet',
            'wetsuit',
            'wet-suit',
            'surfer',
            'surf',
            'trunks',
            'bikini',
            'boardshorts',
            'board',
            'drysuit',
            'dry',
            'one-piece',
            'onepiece',
            'rashguard',
            'rash',
            'yoga',
            'sports'
        ]
    }, {
        'Jewelry': [
            'earrings',
            'earring',
            'necklace',
            'ring',
            'brooch',
            'brooches',
            'bracelet',
            'bracelets',
            'amethyst',
            'emerald',
            'jade',
            'jasper',
            'ruby',
            'sapphire',
            'diamond',
            'gold'
        ]
    }, {
        'Underwear': [
            'brassiere',
            'underwear',
            'underpants',
            'boxers',
            'briefs',
            'boxer',
            'brief',
            'panties',
            'slip',
            'hoisery',
            'bra',
            'bras'
        ]
    }, {
        'Tights & Leggings': [
            'tights',
            'leggings',
            'legging'
        ]
    }]
    categories.forEach(function(category) {
        for (var key in category) {
            if (category.hasOwnProperty(key)) {
                tags.forEach(function(tag) {
                    for (var i = 0; i < category[key].length; i++) {
                        if (category[key][i].trim() == tag.trim()) {
                            newCategories.push(key);
                        }
                    }
                })
            }
        }
    })
    tags.concat(newCategories)
    return tags
}



function eliminateDuplicates(arr) {
    var i,
        len = arr.length,
        out = [],
        obj = {};

    for (i = 0; i < len; i++) {
        obj[arr[i]] = 0;
    }
    for (i in obj) {
        out.push(i);
    }
    return out;
}

String.prototype.removeStopWords = function() {
    var x;
    var y;
    var word;
    var stop_word;
    var regex_str;
    var regex;
    var cleansed_string = this.valueOf();
    var stop_words = new Array(
        'a',
        'about',
        'above',
        'across',
        'after',
        'again',
        'against',
        'all',
        'almost',
        'alone',
        'along',
        'already',
        'also',
        'although',
        'always',
        'among',
        'an',
        'and',
        'another',
        'any',
        'anybody',
        'anyone',
        'anything',
        'anywhere',
        'are',
        'area',
        'areas',
        'around',
        'as',
        'ask',
        'asked',
        'asking',
        'asks',
        'at',
        'away',
        'b',
        'be',
        'became',
        'because',
        'become',
        'becomes',
        'been',
        'before',
        'began',
        'behind',
        'being',
        'beings',
        'best',
        'better',
        'between',
        'both',
        'but',
        'by',
        'c',
        'came',
        'can',
        'cannot',
        'case',
        'cases',
        'certain',
        'certainly',
        'clearly',
        'come',
        'could',
        'd',
        'did',
        'differ',
        'different',
        'differently',
        'do',
        'does',
        'done',
        'downing',
        'downs',
        'during',
        'e',
        'each',
        'early',
        'either',
        'end',
        'ended',
        'ending',
        'enough',
        'evenly',
        'ever',
        'every',
        'everybody',
        'everyone',
        'everything',
        'everywhere',
        'f',
        'fact',
        'facts',
        'far',
        'find',
        'finds',
        'first',
        'for',
        'four',
        'from',
        'fully',
        'further',
        'furthered',
        'furthering',
        'furthers',
        'g',
        'gave',
        'general',
        'generally',
        'get',
        'gets',
        'give',
        'given',
        'gives',
        'go',
        'going',
        'got',
        'h',
        'had',
        'has',
        'have',
        'having',
        'he',
        'her',
        'here',
        'him',
        'his',
        'how',
        'however',
        'i',
        'if',
        'important',
        'in',
        'interest',
        'interested',
        'interesting',
        'interests',
        'into',
        'is',
        'it',
        'its',
        'itself',
        'j',
        'just',
        'k',
        'keep',
        'keeps',
        'kind',
        'knew',
        'know',
        'known',
        'knows',
        'l',
        'largely',
        'last',
        'later',
        'latest',
        'least',
        'less',
        'let',
        'lets',
        'like',
        'likely',
        'longer',
        'longest',
        'm',
        'made',
        'make',
        'making',
        'many',
        'might',
        'more',
        'most',
        'mostly',
        'much',
        'must',
        'my',
        'myself',
        'n',
        'necessary',
        'need',
        'needed',
        'needing',
        'needs',
        'never',
        'new',
        'new',
        'newer',
        'newest',
        'next',
        'no',
        'nobody',
        'non',
        'noone',
        'not',
        'nothing',
        'now',
        'nowhere',
        'o',
        'of',
        'often',
        'on',
        'once',
        'one',
        'only',
        'opens',
        'or',
        'order',
        'ordered',
        'ordering',
        'orders',
        'other',
        'others',
        'our',
        'out',
        'over',
        'p',
        'per',
        'perhaps',
        'place',
        'places',
        'pointing',
        'points',
        'possible',
        'present',
        'presented',
        'presenting',
        'presents',
        'problem',
        'problems',
        'put',
        'puts',
        'q',
        'quite',
        'r',
        'rather',
        'really',
        'right',
        'right',
        'room',
        'rooms',
        's',
        'said',
        'same',
        'saw',
        'say',
        'says',
        'second',
        'seconds',
        'see',
        'seem',
        'seemed',
        'seeming',
        'seems',
        'sees',
        'several',
        'shall',
        'should',
        'show',
        'showed',
        'shows',
        'side',
        'sides',
        'since',
        'so',
        'some',
        'somebody',
        'someone',
        'something',
        'somewhere',
        'state',
        'states',
        'still',
        'still',
        'such',
        'sure',
        't',
        'take',
        'taken',
        'than',
        'that',
        'the',
        'their',
        'them',
        'then',
        'there',
        'therefore',
        'these',
        'they',
        'thing',
        'things',
        'think',
        'thinks',
        'this',
        'those',
        'though',
        'thought',
        'thoughts',
        'through',
        'thus',
        'to',
        'together',
        'too',
        'took',
        'toward',
        'turn',
        'turned',
        'turning',
        'turns',
        'u',
        'under',
        'undefined',
        'until',
        'up',
        'upon',
        'us',
        'use',
        'used',
        'uses',
        'v',
        'very',
        'w',
        'want',
        'wanted',
        'wanting',
        'wants',
        'was',
        'way',
        'ways',
        'we',
        'well',
        'wells',
        'went',
        'were',
        'what',
        'when',
        'where',
        'whether',
        'which',
        'while',
        'who',
        'whole',
        'whose',
        'why',
        'will',
        'with',
        'within',
        'without',
        'work',
        'worked',
        'working',
        'works',
        'would',
        'x',
        'y',
        'year',
        'years',
        'yet',
        'z'
    )

    // Split out all the individual words in the phrase
    words = cleansed_string.match(/[^\s]+|\s+[^\s+]$/g)

    // Review all the words

    if (!words || words == null || words == undefined) {
        return ''
    }

    for (x = 0; x < words.length; x++) {

        //Remove any word with digits in them "3W" "4E" etc
        var matches = words[x].match(/\d+/g);
        if (matches !== null) {
            cleansed_string = cleansed_string.replace(words[x], "");
        }

        // For each word, check all the stop words
        for (y = 0; y < stop_words.length; y++) {
            // Get the current word
            word = words[x].replace(/\s+|[^a-z]+/ig, ""); // Trim the word and remove non-alpha

            // Get the stop word
            stop_word = stop_words[y];

            // If the word matches the stop word, remove it from the keywords
            if (word.toLowerCase() == stop_word) {
                // Build the regex
                regex_str = "^\\s*" + stop_word + "\\s*$"; // Only word
                regex_str += "|^\\s*" + stop_word + "\\s+"; // First word
                regex_str += "|\\s+" + stop_word + "\\s*$"; // Last word
                regex_str += "|\\s+" + stop_word + "\\s+"; // Word somewhere in the middle
                regex = new RegExp(regex_str, "ig");
                // Remove the word from the keywords
                cleansed_string = cleansed_string.replace(regex, " ");
            }
        }
    }
    return cleansed_string.replace(/^\s+|\s+$/g, "");
}

